# SPDX-License-Identifier: ((GPL-2.0 WITH Linux-syscall-note) OR BSD-3-Clause)
#
# Author: Aurelien Aptel <aaptel@nvidia.com>
#
# Copyright (c) 2023, NVIDIA CORPORATION & AFFILIATES.  All rights reserved.
#

name: ulp_ddp

protocol: genetlink

doc: Netlink protocol to manage ULP DPP on network devices.

definitions:
  -
    type: enum
    name: cap
    render-max: true
    entries:
      - nvme-tcp
      - nvme-tcp-ddgst-rx

attribute-sets:
  -
    name: stats
    attributes:
      -
        name: ifindex
        doc: Interface index of the net device.
        type: u32
      -
        name: rx-nvme-tcp-sk-add
        doc: Sockets successfully configured for NVMeTCP offloading.
        type: uint
      -
        name: rx-nvme-tcp-sk-add-fail
        doc: Sockets failed to be configured for NVMeTCP offloading.
        type: uint
      -
        name: rx-nvme-tcp-sk-del
        doc: Sockets with NVMeTCP offloading configuration removed.
        type: uint
      -
        name: rx-nvme-tcp-setup
        doc: NVMe-TCP IOs successfully configured for Rx Direct Data Placement.
        type: uint
      -
        name: rx-nvme-tcp-setup-fail
        doc: NVMe-TCP IOs failed to be configured for Rx Direct Data Placement.
        type: uint
      -
        name: rx-nvme-tcp-teardown
        doc: NVMe-TCP IOs with Rx Direct Data Placement configuration removed.
        type: uint
      -
        name: rx-nvme-tcp-drop
        doc: Packets failed the NVMeTCP offload validation.
        type: uint
      -
        name: rx-nvme-tcp-resync
        doc: >
          NVMe-TCP resync operations were processed due to Rx TCP packets
          re-ordering.
        type: uint
      -
        name: rx-nvme-tcp-packets
        doc: TCP packets successfully processed by the NVMeTCP offload.
        type: uint
      -
        name: rx-nvme-tcp-bytes
        doc: Bytes were successfully processed by the NVMeTCP offload.
        type: uint
  -
    name: caps
    attributes:
      -
        name: ifindex
        doc: Interface index of the net device.
        type: u32
      -
        name: hw
        doc: Bitmask of the capabilities supported by the device.
        type: uint
        enum: cap
        enum-as-flags: true
      -
        name: active
        doc: Bitmask of the capabilities currently enabled on the device.
        type: uint
        enum: cap
        enum-as-flags: true
      -
        name: wanted
        doc: >
          New active bit values of the capabilities we want to set on the
          device.
        type: uint
        enum: cap
        enum-as-flags: true
      -
        name: wanted_mask
        doc: Bitmask of the meaningful bits in the wanted field.
        type: uint
        enum: cap
        enum-as-flags: true

operations:
  list:
    -
      name: caps-get
      doc: Get ULP DDP capabilities.
      attribute-set: caps
      do:
        request:
          attributes:
            - ifindex
        reply:
          attributes:
            - ifindex
            - hw
            - active
        pre: ulp_ddp_get_netdev
        post: ulp_ddp_put_netdev
    -
      name: stats-get
      doc: Get ULP DDP stats.
      attribute-set: stats
      do:
        request:
          attributes:
            - ifindex
        reply:
          attributes:
            - ifindex
            - rx-nvme-tcp-sk-add
            - rx-nvme-tcp-sk-add-fail
            - rx-nvme-tcp-sk-del
            - rx-nvme-tcp-setup
            - rx-nvme-tcp-setup-fail
            - rx-nvme-tcp-teardown
            - rx-nvme-tcp-drop
            - rx-nvme-tcp-resync
            - rx-nvme-tcp-packets
            - rx-nvme-tcp-bytes
        pre: ulp_ddp_get_netdev
        post: ulp_ddp_put_netdev
    -
      name: caps-set
      doc: Set ULP DDP capabilities.
      attribute-set: caps
      do:
        request:
          attributes:
            - ifindex
            - wanted
            - wanted_mask
        reply:
          attributes:
            - ifindex
            - hw
            - active
        pre: ulp_ddp_get_netdev
        post: ulp_ddp_put_netdev
    -
      name: caps-set-ntf
      doc: Notification for change in ULP DDP capabilities.
      notify: caps-get

mcast-groups:
  list:
    -
      name: mgmt
